#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∑–∞–ø—á–∞—Å—Ç–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
–û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –∑–∞–ø—á–∞—Å—Ç–∏, –¥–æ–±–∞–≤–ª—è—è –ø–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ –∏–≤—Ä–∏—Ç
"""

import os
from models import db, Part

# –°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∑–∞–ø—á–∞—Å—Ç–µ–π
PARTS_TRANSLATIONS = {
    # –¢–æ—Ä–º–æ–∑–∞
    '—Ç–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å': {
        'en': 'Brake fluid',
        'he': '◊†◊ï◊ñ◊ú ◊ë◊ú◊û◊ô◊ù'
    },
    '—Å–ø—Ä–µ–π –¥–ª—è —Ç–æ—Ä–º–æ–∑–æ–≤': {
        'en': 'Brake cleaner spray',
        'he': '◊°◊§◊®◊ô◊ô ◊ú◊†◊ô◊ß◊ï◊ô ◊ë◊ú◊û◊ô◊ù'
    },
    '—Å–ø—Ä–µ–π –¥–ª—è —Ç–æ—Ä–º–æ–∑–æ–≤ (–æ—á–∏—Å—Ç–∏—Ç–µ–ª—å)': {
        'en': 'Brake cleaner spray',
        'he': '◊°◊§◊®◊ô◊ô ◊ú◊†◊ô◊ß◊ï◊ô ◊ë◊ú◊û◊ô◊ù'
    },
    '–ø—Ä–æ–±–∫–∞ –ø–æ–¥–¥–æ–Ω–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è': {
        'en': 'Oil drain plug',
        'he': '◊§◊ß◊ß ◊û◊ô◊õ◊ú ◊©◊û◊ü'
    },
    '–ø—Ä–æ–±–∫–∞ –ø–æ–¥–¥–æ–Ω–∞ –¥–≤–∏–≥–∞—Ç–µ–ª—è (—Å–ª–∏–≤–Ω–æ–π –±–æ–ª—Ç)': {
        'en': 'Oil drain plug (drain bolt)',
        'he': '◊§◊ß◊ß ◊û◊ô◊õ◊ú ◊©◊û◊ü (◊ë◊ï◊®◊í ◊†◊ô◊ß◊ï◊ñ)'
    },
    '–∫–æ–ª–æ–¥–∫–∏ —Ç–æ—Ä–º–æ–∑–Ω—ã–µ –ø–µ—Ä–µ–¥–Ω–∏–µ': {
        'en': 'Front brake pads',
        'he': '◊®◊§◊ô◊ì◊ï◊™ ◊ë◊ú◊ù ◊ß◊ì◊û◊ô◊ï◊™'
    },
    '–∫–æ–ª–æ–¥–∫–∏ —Ç–æ—Ä–º–æ–∑–Ω—ã–µ –∑–∞–¥–Ω–∏–µ': {
        'en': 'Rear brake pads',
        'he': '◊®◊§◊ô◊ì◊ï◊™ ◊ë◊ú◊ù ◊ê◊ó◊ï◊®◊ô◊ï◊™'
    },
    '–¥–∏—Å–∫–∏ —Ç–æ—Ä–º–æ–∑–Ω—ã–µ –ø–µ—Ä–µ–¥–Ω–∏–µ': {
        'en': 'Front brake discs',
        'he': '◊ì◊ô◊°◊ß◊ô ◊ë◊ú◊ù ◊ß◊ì◊û◊ô◊ô◊ù'
    },
    '–¥–∏—Å–∫–∏ —Ç–æ—Ä–º–æ–∑–Ω—ã–µ –∑–∞–¥–Ω–∏–µ': {
        'en': 'Rear brake discs',
        'he': '◊ì◊ô◊°◊ß◊ô ◊ë◊ú◊ù ◊ê◊ó◊ï◊®◊ô◊ô◊ù'
    },
    '—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä': {
        'en': 'Stabilizer bar',
        'he': '◊û◊ï◊ò ◊û◊ô◊ô◊¶◊ë'
    },
    
    # –î–≤–∏–≥–∞—Ç–µ–ª—å / –¢–∏–ø—É–ª—å
    '—Ñ–∏–ª—å—Ç—Ä –º–∞—Å–ª—è–Ω—ã–π': {
        'en': 'Oil filter',
        'he': '◊§◊ô◊ú◊ò◊® ◊©◊û◊ü'
    },
    '—Ñ–∏–ª—å—Ç—Ä –≤–æ–∑–¥—É—à–Ω—ã–π': {
        'en': 'Air filter',
        'he': '◊§◊ô◊ú◊ò◊® ◊ê◊ï◊ï◊ô◊®'
    },
    '—Ñ–∏–ª—å—Ç—Ä —Å–∞–ª–æ–Ω–Ω—ã–π': {
        'en': 'Cabin filter',
        'he': '◊§◊ô◊ú◊ò◊® ◊™◊ê ◊†◊ï◊°◊¢◊ô◊ù'
    },
    '–º–∞—Å–ª–æ –º–æ—Ç–æ—Ä–Ω–æ–µ': {
        'en': 'Engine oil',
        'he': '◊©◊û◊ü ◊û◊†◊ï◊¢'
    },
    '—Å–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è': {
        'en': 'Spark plugs',
        'he': '◊û◊¶◊™◊ô◊ù'
    },
    '—Ä–µ–º–µ–Ω—å –≥—Ä–º': {
        'en': 'Timing belt',
        'he': '◊®◊¶◊ï◊¢◊™ ◊™◊ñ◊û◊ï◊ü'
    },
    '–∞–Ω—Ç–∏—Ñ—Ä–∏–∑': {
        'en': 'Antifreeze',
        'he': '◊†◊ï◊ñ◊ú ◊ß◊ô◊®◊ï◊®'
    },
    
    # –ñ–∏–¥–∫–æ—Å—Ç–∏
    '–∂–∏–¥–∫–æ—Å—Ç—å –æ–º—ã–≤–∞—Ç–µ–ª—è': {
        'en': 'Washer fluid',
        'he': '◊†◊ï◊ñ◊ú ◊©◊û◊©◊ï◊™'
    },
    '–º–∞—Å–ª–æ —Ç—Ä–∞–Ω—Å–º–∏—Å—Å–∏–æ–Ω–Ω–æ–µ': {
        'en': 'Transmission oil',
        'he': '◊©◊û◊ü ◊™◊ô◊ë◊™ ◊î◊ô◊ú◊ï◊õ◊ô◊ù'
    },
    '–∂–∏–¥–∫–æ—Å—Ç—å –≥–∏–¥—Ä–æ—É—Å–∏–ª–∏—Ç–µ–ª—è': {
        'en': 'Power steering fluid',
        'he': '◊†◊ï◊ñ◊ú ◊î◊í◊î ◊õ◊ï◊ó'
    },
    
    # –≠–ª–µ–∫—Ç—Ä–∏–∫–∞ / –õ–∞–º–ø–æ—á–∫–∏
    '–ª–∞–º–ø–∞ h7': {
        'en': 'H7 bulb',
        'he': '◊†◊ï◊®◊î H7'
    },
    '–ª–∞–º–ø–∞ h4': {
        'en': 'H4 bulb',
        'he': '◊†◊ï◊®◊î H4'
    },
    '–ª–∞–º–ø–∞ h1': {
        'en': 'H1 bulb',
        'he': '◊†◊ï◊®◊î H1'
    },
    '–ª–∞–º–ø–æ—á–∫–∞': {
        'en': 'Bulb',
        'he': '◊†◊ï◊®◊î'
    },
    '–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä': {
        'en': 'Battery',
        'he': '◊û◊¶◊ë◊®'
    },
    
    # –ü–æ–¥–≤–µ—Å–∫–∞
    '–∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ–¥–Ω–∏–π': {
        'en': 'Front shock absorber',
        'he': '◊ë◊ï◊ú◊ù ◊ñ◊¢◊ñ◊ï◊¢◊ô◊ù ◊ß◊ì◊û◊ô'
    },
    '–∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä –∑–∞–¥–Ω–∏–π': {
        'en': 'Rear shock absorber',
        'he': '◊ë◊ï◊ú◊ù ◊ñ◊¢◊ñ◊ï◊¢◊ô◊ù ◊ê◊ó◊ï◊®◊ô'
    },
    '–ø—Ä—É–∂–∏–Ω–∞ –ø–µ—Ä–µ–¥–Ω—è—è': {
        'en': 'Front spring',
        'he': '◊ß◊§◊ô◊• ◊ß◊ì◊û◊ô'
    },
    '–ø—Ä—É–∂–∏–Ω–∞ –∑–∞–¥–Ω—è—è': {
        'en': 'Rear spring',
        'he': '◊ß◊§◊ô◊• ◊ê◊ó◊ï◊®◊ô'
    },
    
    # –•–∏–º–∏—è
    'wd-40': {
        'en': 'WD-40',
        'he': 'WD-40'
    },
    '–æ—á–∏—Å—Ç–∏—Ç–µ–ª—å': {
        'en': 'Cleaner',
        'he': '◊û◊†◊ß◊î'
    }
}

def find_translation(part_name):
    """–ù–∞–π—Ç–∏ –ø–µ—Ä–µ–≤–æ–¥ –¥–ª—è –∑–∞–ø—á–∞—Å—Ç–∏"""
    if not part_name:
        return None
    
    # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É –¥–ª—è –ø–æ–∏—Å–∫–∞
    name_lower = part_name.lower().strip()
    
    # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    if name_lower in PARTS_TRANSLATIONS:
        return PARTS_TRANSLATIONS[name_lower]
    
    # –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    for key, translation in PARTS_TRANSLATIONS.items():
        if key in name_lower or name_lower in key:
            return translation
    
    return None

def migrate_parts_translations():
    """–ú–∏–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∑–∞–ø—á–∞—Å—Ç–µ–π"""
    
    print("üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∑–∞–ø—á–∞—Å—Ç–µ–π...")
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø—á–∞—Å—Ç–∏
    parts = Part.query.all()
    updated_count = 0
    
    for part in parts:
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã
        if part.name_he and part.name_en:
            continue
        
        # –ò—â–µ–º –ø–µ—Ä–µ–≤–æ–¥ –ø–æ name_ru
        translation = find_translation(part.name_ru)
        
        if not translation:
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Å—Ç–∞—Ä–æ–º—É –ø–æ–ª—é name
            translation = find_translation(part.name)
        
        if translation:
            needs_update = False
            
            if not part.name_en:
                part.name_en = translation['en']
                needs_update = True
            
            if not part.name_he:
                part.name_he = translation['he']
                needs_update = True
            
            if needs_update:
                print(f"‚úÖ {part.name_ru or part.name} ‚Üí {part.name_he}")
                updated_count += 1
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
    if updated_count > 0:
        db.session.commit()
        print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞–ø—á–∞—Å—Ç–µ–π: {updated_count}")
    else:
        print("‚ÑπÔ∏è  –í—Å–µ –∑–∞–ø—á–∞—Å—Ç–∏ —É–∂–µ –∏–º–µ—é—Ç –ø–µ—Ä–µ–≤–æ–¥—ã")
    
    return updated_count
